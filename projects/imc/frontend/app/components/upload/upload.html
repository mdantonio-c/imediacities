
<div class='container-fluid'>
<div class="row justify-content-md-center">
<div class='col-12'>

<div class='card'>
<div class='card-header'>
	<h4 class='panel-title'>
		<i class='fa fa-cloud-upload'></i> Upload new content
	</h4>
</div>

<div class='card-block'>

	<div class='row'>
	<div class="col-md-3">

		<h3>Select files</h3>

		<br>

		<input type="file" ng2FileSelect [uploader]="uploader" multiple/><br/>

		<br><br>

	    <div ng2FileDrop
	         [ngClass]="{'nv-file-over': hasDropZoneOver}"
	         (fileOver)="fileOver($event)"
	         [uploader]="uploader"
	         class="well my-drop-zone">
	        Drop here your files 
	    </div>
    </div>

    <div class="col-md-9" style="margin-bottom: 40px">

    	<div class='row'>
    	<div class='col-4'>
        	<h3>Upload queue</h3>
        </div>
        <div class='col-8'>
            <ngb-progressbar 
	            *ngIf='uploader.queue.length'
            	showValue="true"
            	type="info"
            	[value]="uploader.progress"
            ></ngb-progressbar>
        </div>
        </div>
		<br>

        <ng-template #emptyQueue>
			No element in queue
        </ng-template>
        <table class="table" *ngIf='uploader.queue.length; else emptyQueue'>
            <thead>
            <tr>
                <th width="50%">Name</th>
                <th>Size</th>
                <th>Status</th>
                <th colspan=2>Actions</th>
            </tr>
            </thead>
            <tbody>
            <tr *ngFor="let item of uploader.queue">
                <td><strong>{{ item?.file?.name }}</strong></td>
                <td>{{item?.file?.size | bytes}}</td>

                <td>

		            <ngb-progressbar 
		            	*ngIf="item.isUploading"
		            	showValue="false"
		            	type="info"
		            	[value]="item.progress"
		            ></ngb-progressbar>

                    <span *ngIf="item.isSuccess">
	                    <i class='fa fa-check fa-large'
	                    	style='color:green;'
	                    	ngbTooltip='Upload completed'
	                    	></i>
                    </span>

                    <span *ngIf="item.isCancel">
	                    <i class='fa fa-ban fa-large'
	                    	style='color:orange;'
	                    	ngbTooltip='Upload cancelled'
	                    	></i>
                    </span>

                    <span *ngIf="item.isError">
	                    <i class='fa fa-exclamation fa-large'
	                    	style='color:red;'
	                    	ngbTooltip='Upload errored'
	                    	></i>
                    </span>

                </td>

                <td>

                    <i class='fa fa-trash fa-large' style='color:red;'
                		(click)="item.remove()"
                        ngbTooltip='Remove upload'></i>

                </td>

                <td>
                    <i class='fa fa-play fa-large' style='color:green;'
                		(click)="item.upload()"
                        *ngIf="!item.isReady && !item.isUploading && !item.isSuccess"
                        ngbTooltip='Start upload'></i>

                    <i class='fa fa-ban fa-large' style='color:orange;'
                		(click)="item.cancel()"
                        *ngIf="item.isUploading"
                        ngbTooltip='Cancel upload'></i>
                </td>

            </tr>
            </tbody>
        </table>

        <div *ngIf='uploader.queue.length'>
            <button type="button" class="btn btn-success btn-s"
                    (click)="uploader.uploadAll()" [disabled]="!uploader.getNotUploadedItems().length">
                <span class="glyphicon glyphicon-upload"></span> Upload all
            </button>
            <button type="button" class="btn btn-warning btn-s"
                    (click)="uploader.cancelAll()" [disabled]="!uploader.isUploading">
                <span class="glyphicon glyphicon-ban-circle"></span> Cancel all
            </button>
            <button type="button" class="btn btn-danger btn-s"
                    (click)="uploader.clearQueue()" [disabled]="!uploader.queue.length">
                <span class="glyphicon glyphicon-trash"></span> Remove all
            </button>
	    </div>
	</div>
	</div>
</div>
</div>

<!--
    <div flow-init="flowOptions"
        ng-controller='NgFlowController'
        flow-upload-started='ctrl.uploadStart(event, $flow, $flowFile)'
        flow-complete='ctrl.uploadComplete(event, $flow, flowFile)'
        flow-file-error='showNgUploadErrors($file, $message, $flow)'
        flow-files-submitted="$flow.upload()"
        flow-file-success="$file.msg = $message">
        <span class="btn btn-small btn-info" flow-btn><i class="icon icon-file"></i>Upload a file</span>
        <span class="btn btn-small btn-info" flow-btn flow-directory><i class="icon icon-folder-open"></i>
          Upload a folder
        </span>
        <br><br>
        <div class="well">
          <a class="btn btn-small btn-success" ng-click="$flow.resume()">Resume all</a>
          <a class="btn btn-small btn-warning" ng-click="$flow.pause()">Pause all</a>
          <a class="btn btn-small btn-danger" ng-click="$flow.cancel()">Cancel all</a>
          <span ng-if='$flow.getSize() > 0' class="label label-info">Total Size: {{$flow.getSize() | bytes}}</span>
        </div>
        <div class='table-responsive' ng-if='$flow.files.length'>
          <table class='table table-hover'>
            <tr>
              <th>#</th>
              <th>name</th>
              <th>size</th>
              <th>progress</th>
            </tr>
            <tr ng-repeat="file in $flow.files">
              <td>{{$index+1}}</td>
              <td>{{file.name}}</td>
              <td>{{file.size | bytes}}</td>
              <td ng-include="main.templateDir + 'ngflow.progressbar.html'"></td>
            </tr>
          </table>
        </div>
    </div>
    -->
<br>

<div class='card'>
<div class='card-header'>
	<h4 class='panel-title'>
		<i class='fa fa-files-o'></i> Your files
	</h4>
</div>

<div class='card-block'>

<loading *ngIf="loading"></loading>

<div class="table-responsive" *ngIf="!loading">

	<ngx-datatable
		[rows]="rows"
		[columns]="columns"
		[columnMode]="'flex'"
		[loadingIndicator]='true'
		[footerHeight]="50"
		[limit]="itemsPerPage">
		<ngx-datatable-footer>
			<ng-template 
				ngx-datatable-footer-template
				let-pageSize="pageSize"
				let-selectedCount="selectedCount"
				let-curPage="curPage"
				let-offset="offset">
				<div class='col-3'>
					{{paging.dataLength}} total
				</div>
				<div class='col-9'>
				<div class='float-right'>
				<ngb-pagination
					boundaryLinks="true"
					directionLinks="true"
					[page]="paging.page"
					[pageSize]="paging.itemsPerPage"
					[collectionSize]="paging.dataLength"
                    [maxSize]="5"
                    [rotate]="true"
					size="sm"
					(pageChange)="setPage($event)"
				>
				</ngb-pagination>
				</div>
				</div>
			</ng-template>
		</ngx-datatable-footer>
	</ngx-datatable>

</div>
	<ng-template #dataSize let-row="row" let-value="value" let-i="index">

        {{value | bytes}}

	</ng-template>

	<ng-template #dataUploadData let-row="row" let-value="value" let-i="index">
        <span 
            ngbTooltip="{{1000*value | date : 'yyyy MMM dd HH:mm:ss'}}"
            >
            {{value | amFromUnix | amTimeAgo:false }}
        </span>
    </ng-template>

	<ng-template #dataStatus let-row="row" let-value="value" let-i="index">
        <span *ngIf='row.status_message; else noStatus'
        	class='badge badge-secondary'
        	[ngClass]="{
	            'badge-success': row.status == 'COMPLETED',
	            'badge-danger': row.status == 'ERROR',
	            'badge-info': row.status == 'IMPORTING'
	        }"
    	   	ngbTooltip="{{row.status_message}}">

            {{value}}
            <span class="badge badge-warning" *ngIf="row.warnings">
				<i class="imc-icon fa fa-exclamation-triangle"></i>
            </span>
		</span>
                      
        <ng-template #noStatus>
			{{value}}
        </ng-template>

    </ng-template>


	<ng-template #emptyHeader let-column="column">
		&nbsp;
	</ng-template>

	<ng-template #controlsCell let-row="row" let-value="value" let-i="index">
		<i class='fa fa-download fa-large' (click)='download(row.name)'></i>

		<i 
			class='fa fa-trash fa-large' style='color:red;'
			*ngIf="row.status != 'IMPORTING'; else disableDelete"
	        mwlConfirmationPopover
	        [popoverTitle]="deleteConfirmation.title"
	        [popoverMessage]="deleteConfirmation.message"
            [appendToBody]="true"
	        placement="left"
	        (confirm)="remove(row.name)"
	        (cancel)="cancelRequest()"></i>

        <ng-template #disableDelete>
			<i class='fa fa-trash fa-large'
				ngbTooltip="Disabled during the import">
			</i>
        </ng-template>
	</ng-template>

</div>
</div>

</div>
</div>
</div>